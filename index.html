<!DOCTYPE html>
<html>
<head>
    <title>Etude Psychologique</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body style="background-color: #f5f5f5;">
    <script>
        // Initialisation de l'expérience
        const jsPsych = initJsPsych({
            on_finish: function() {
                // Cette partie s'affiche à la toute fin
                document.body.innerHTML = `
                    <div style="margin: 50px auto; max-width: 600px; padding: 20px; background: white; border-radius: 10px; font-family: sans-serif; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2>Merci !</h2>
                        <p>L'exercice est maintenant terminé.</p>
                        <p style="color: gray; font-size: 0.8em;">(Les données ont été enregistrées dans la console du navigateur)</p>
                    </div>`;
                // Affiche les données en petit sous le message pour que TU puisses les voir
                jsPsych.data.displayData();
            }
        });

        // 50% de chance d'être exclu
        const isExcluded = Math.random() < 0.5;
        jsPsych.data.addProperties({ condition_sociale: isExcluded ? 'Exclusion' : 'Inclusion' });

        let timeline = [];

        // Écran de bienvenue (pour éviter la page blanche au démarrage)
        const welcome = {
            type: jsPsychHtmlButtonResponse,
            stimulus: "<h3>Bienvenue dans cette étude sur les interactions sociales.</h3><p>Cliquez sur le bouton pour commencer.</p>",
            choices: ['Commencer']
        };
        timeline.push(welcome);

        // L'interaction sociale
        const social_trial = {
            type: jsPsychHtmlButtonResponse,
            stimulus: function() {
                return `
                <div style="border:1px solid #ccc; padding:20px; border-radius:10px; width:400px; margin:20px auto; background:white; font-family:sans-serif; text-align:left;">
                    <p><strong>@Vous :</strong> "Enfin en week-end ! Des projets ?"</p>
                    <hr>
                    <div id="feedback" style="height:60px; display:flex; align-items:center;">
                        <span style="color:orange;">Chargement des réponses des autres joueurs...</span>
                    </div>
                </div>`;
            },
            choices: ['Actualiser les notifications'],
            on_load: function() {
                // On cache le bouton au début
                const btn = document.querySelector('.jspsych-btn');
                btn.style.display = 'none';
                
                // Délai de 3 secondes pour faire "vrai"
                setTimeout(() => {
                    const div = document.getElementById('feedback');
                    if (isExcluded) {
                        div.innerHTML = "<span style='color:#e74c3c;'>Aucune réponse. Les autres joueurs semblent interagir entre eux ailleurs.</span>";
                    } else {
                        div.innerHTML = "<span style='color:#2ecc71;'><strong>@Julie :</strong> Trop cool !<br><strong>@Marc :</strong> Moi je pars à la mer !</span>";
                    }
                    // On montre le bouton "Continuer"
                    btn.style.display = 'inline-block';
                    btn.innerHTML = 'Continuer';
                }, 3000);
            }
        };
        timeline.push(social_trial);

        // Lancer l'expérience
        jsPsych.run(timeline);
    </script>
</body>
</html>
